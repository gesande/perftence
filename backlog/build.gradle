import org.gradle.api.Task

project(':backlog') {
    apply from:"$buildPlugins/gradlePlugins.gradle"

    task showBacklog { Task task ->
        group = 'Backlog'
        description= 'Shows backlog.'
        doLast { println backlog(task) }
    }

    task hereIsSomethingTodo { Task task ->
        group = 'Backlog'
        description= 'Shows all stuff waiting for implementation.'

        doLast {
            def ByteArrayOutputStream backlogOut = backlog(task)
            def ByteArrayInputStream stdIn = new ByteArrayInputStream(backlogOut.buf)
            def ByteArrayOutputStream somethingTodoOut = new ByteArrayOutputStream()
            task.project.exec {
                standardInput = stdIn
                standardOutput = somethingTodoOut
                commandLine = ['grep', '\\-\\-\\-']
            }
            println "Here's something you could do:"
            println somethingTodoOut
        }
    }

    task featuresWaiting { Task task ->
        group = 'Backlog'
        description= 'Shows all features waiting for implementation.'
        doLast {
            def ByteArrayOutputStream backlogOut = backlog(task)
            def ByteArrayInputStream somethingTodoIn = new ByteArrayInputStream(backlogOut.buf)
            def ByteArrayOutputStream somethingTodoOut = new ByteArrayOutputStream()
            task.project.exec {
                standardInput = somethingTodoIn
                standardOutput = somethingTodoOut
                commandLine = ['grep', '\\-\\-\\-']
            }

            def ByteArrayInputStream stdIn = new ByteArrayInputStream(somethingTodoOut.buf)
            def ByteArrayOutputStream stdOut = new ByteArrayOutputStream()
            task.project.exec {
                commandLine = ['grep' , '#feature']
                standardInput = stdIn
                standardOutput = stdOut
            }
            println stdOut
        }
    }
}

private ByteArrayOutputStream backlog(Task task) {
    def ByteArrayOutputStream backlogOut = new ByteArrayOutputStream()
    task.project.exec {
        commandLine = [
            "${task.project.projectDir}/show.sh"
        ]
        standardOutput = backlogOut
    }
    return backlogOut
}